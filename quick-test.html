<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€ŸåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        .test-button:hover {
            background: #5a6fd8;
        }
        #results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ã€Šåè¯ˆå…ˆé”‹ã€‹å¿«é€ŸåŠŸèƒ½æµ‹è¯•</h1>

        <p>è¿™ä¸ªé¡µé¢å°†æµ‹è¯•æ¸¸æˆçš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p>
        <ul>
            <li>å…¨å±€å¯¹è±¡åˆå§‹åŒ–</li>
            <li>åœºæ™¯æ•°æ®å®Œæ•´æ€§</li>
            <li>æœ¬åœ°å­˜å‚¨åŠŸèƒ½</li>
            <li>æ¸¸æˆæ ¸å¿ƒåŠŸèƒ½</li>
            <li>æ•™ç¨‹ç³»ç»Ÿ</li>
            <li>åœºæ™¯ç®¡ç†å™¨</li>
            <li>DOMå…ƒç´ å®Œæ•´æ€§</li>
            <li>CSSæ ·å¼åŠ è½½</li>
            <li>è®¾å¤‡é€‚é…</li>
            <li>é”™è¯¯å¤„ç†æœºåˆ¶</li>
        </ul>

        <button class="test-button" onclick="runTests()">å¼€å§‹æµ‹è¯•</button>
        <button class="test-button" onclick="openGame()">æ‰“å¼€æ¸¸æˆ</button>

        <div id="status" class="status" style="display: none;"></div>
        <div id="results" class="loading">ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®å¼€å§‹åŠŸèƒ½æµ‹è¯•...</div>
    </div>

    <!-- åŠ è½½æ¸¸æˆèµ„æº -->
    <script src="js/device-adaptation.js"></script>
    <script src="js/performance.js"></script>
    <script src="js/touch-enhancement.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/scenarios.js"></script>
    <script src="js/tutorial.js"></script>
    <script src="js/game.js"></script>
    <script src="js/debug.js"></script>
    <script src="js/init.js"></script>

    <script>
        // ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
        let initCheckInterval;

        function waitForInitialization() {
            return new Promise((resolve) => {
                initCheckInterval = setInterval(() => {
                    if (window.game && window.storage && window.tutorial) {
                        clearInterval(initCheckInterval);
                        resolve();
                    }
                }, 100);

                // è¶…æ—¶ä¿æŠ¤
                setTimeout(() => {
                    clearInterval(initCheckInterval);
                    resolve();
                }, 5000);
            });
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${isError ? 'error' : 'success'}`;
            statusDiv.style.display = 'block';
        }

        async function runTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = 'â³ æ­£åœ¨åŠ è½½æµ‹è¯•è„šæœ¬...';

            try {
                // ç­‰å¾…æ¸¸æˆåˆå§‹åŒ–
                await waitForInitialization();

                // æ¸…ç©ºæ§åˆ¶å°å¹¶æ˜¾ç¤ºå¼€å§‹ä¿¡æ¯
                console.clear();
                console.log('ğŸ§ª å¼€å§‹ã€Šåè¯ˆå…ˆé”‹ã€‹æ¸¸æˆåŠŸèƒ½æµ‹è¯•...\n');

                resultsDiv.textContent = 'â³ æ­£åœ¨æ‰§è¡Œæµ‹è¯•ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯...';

                // é‡å®šå‘console.logåˆ°é¡µé¢
                const originalLog = console.log;
                let logs = [];
                console.log = function(...args) {
                    originalLog.apply(console, args);
                    logs.push(args.join(' '));
                    resultsDiv.textContent = logs.join('\n');
                };

                // åŠ è½½å¹¶æ‰§è¡Œæµ‹è¯•è„šæœ¬
                const script = document.createElement('script');
                script.src = 'test-functionality.js';
                script.onload = () => {
                    setTimeout(() => {
                        // æ¢å¤console.log
                        console.log = originalLog;

                        if (window.gameTestResults) {
                            const results = window.gameTestResults;
                            if (results.failed === 0) {
                                showStatus(`âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼(${results.passed}/${results.tests.length})`);
                            } else {
                                showStatus(`âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ (${results.failed}/${results.tests.length})`, true);
                            }
                        }
                    }, 2000);
                };
                document.head.appendChild(script);

            } catch (error) {
                resultsDiv.textContent = `âŒ æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}`;
                showStatus(`æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}`, true);
            }
        }

        function openGame() {
            window.open('index.html', '_blank');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.game && window.storage && window.tutorial) {
                    showStatus('âœ… æ¸¸æˆèµ„æºåŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
                } else {
                    showStatus('âš ï¸ æ¸¸æˆèµ„æºä»åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨åå†è¯•', true);
                }
            }, 1000);
        });
    </script>
</body>
</html>